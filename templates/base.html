<!DOCTYPE html>
<html lang="en">
	<head>
		<meta charset="utf-8">
		<meta http-equiv="X-UA-Compatible" content="IE=edge">
		<meta name="viewport" content="width=device-width, initial-scale=1">
		<title>SpaceJobs</title>
		
		<!-- Bootstrap -->
		<link href="{{ url_for('static', filename='css/bootstrap.min.css') }}" rel="stylesheet">
		<link href="{{ url_for('static', filename='css/styles.css') }}" rel="stylesheet">
		<link href="{{ url_for('static', filename='css/queries.css') }}" rel="stylesheet">
		<link rel="stylesheet" href="{{ url_for('static', filename='css/flexslider.css') }}" type="text/css">
		<link rel="stylesheet" href="{{ url_for('static', filename='css/animate.css') }}" type="text/css">
		<link href="http://netdna.bootstrapcdn.com/font-awesome/4.0.3/css/font-awesome.css" rel="stylesheet">
		
		<!-- DataTables CSS -->
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/jquery.dataTables.css') }}">
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/dataTables.responsive.css') }}">
		<link rel="stylesheet" type="text/css" href="{{ url_for('static', filename='css/dataTables.fixedHeader.css') }}">

		<!-- jQuery (necessary for Bootstrap's JavaScript plugins)-->
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
		
		<!-- DataTables -->
		<script type="text/javascript" charset="utf8" src="{{ url_for('static', filename='js/jquery.dataTables.min.js') }}"></script>
		<script type="text/javascript" charset="utf8" src="{{ url_for('static', filename='js/dataTables.responsive.min.js') }}"></script>
		<script type="text/javascript" charset="utf8" src="{{ url_for('static', filename='js/dataTables.fixedHeader.min.js') }}"></script>
		
		<script>


		//
		// Pipelining function for DataTables. To be used to the `ajax` option of DataTables
		//
		$.fn.dataTable.pipeline = function ( opts ) {
		    // Configuration options
		    var conf = $.extend( {
		        pages: 5,     // number of pages to cache
		        url: '',      // script url
		        data: null,   // function or object with parameters to send to the server
		                      // matching how `ajax.data` works in DataTables
		        method: 'GET' // Ajax HTTP method
		    }, opts );
		 
		    // Private variables for storing the cache
		    var cacheLower = -1;
		    var cacheUpper = null;
		    var cacheLastRequest = null;
		    var cacheLastJson = null;
		 
		    return function ( request, drawCallback, settings ) {
		        var ajax          = false;
		        var requestStart  = request.start;
		        var drawStart     = request.start;
		        var requestLength = request.length;
		        var requestEnd    = requestStart + requestLength;
		         
		        if ( settings.clearCache ) {
		            // API requested that the cache be cleared
		            ajax = true;
		            settings.clearCache = false;
		        }
		        else if ( cacheLower < 0 || requestStart < cacheLower || requestEnd > cacheUpper ) {
		            // outside cached data - need to make a request
		            ajax = true;
		        }
		        else if ( JSON.stringify( request.order )   !== JSON.stringify( cacheLastRequest.order ) ||
		                  JSON.stringify( request.columns ) !== JSON.stringify( cacheLastRequest.columns ) ||
		                  JSON.stringify( request.search )  !== JSON.stringify( cacheLastRequest.search )
		        ) {
		            // properties changed (ordering, columns, searching)
		            ajax = true;
		        }
		         
		        // Store the request for checking next time around
		        cacheLastRequest = $.extend( true, {}, request );
		 
		        if ( ajax ) {
		            // Need data from the server
		            if ( requestStart < cacheLower ) {
		                requestStart = requestStart - (requestLength*(conf.pages-1));
		 
		                if ( requestStart < 0 ) {
		                    requestStart = 0;
		                }
		            }
		             
		            cacheLower = requestStart;
		            cacheUpper = requestStart + (requestLength * conf.pages);
		 
		            request.start = requestStart;
		            request.length = requestLength*conf.pages;
		 
		            // Provide the same `data` options as DataTables.
		            if ( $.isFunction ( conf.data ) ) {
		                // As a function it is executed with the data object as an arg
		                // for manipulation. If an object is returned, it is used as the
		                // data object to submit
		                var d = conf.data( request );
		                if ( d ) {
		                    $.extend( request, d );
		                }
		            }
		            else if ( $.isPlainObject( conf.data ) ) {
		                // As an object, the data given extends the default
		                $.extend( request, conf.data );
		            }
		 
		            settings.jqXHR = $.ajax( {
		                "type":     conf.method,
		                "url":      conf.url,
		                "data":     request,
		                "dataType": "json",
		                "cache":    false,
		                "success":  function ( json ) {
		                    cacheLastJson = $.extend(true, {}, json);
		 
		                    if ( cacheLower != drawStart ) {
		                        json.data.splice( 0, drawStart-cacheLower );
		                    }
		                    json.data.splice( requestLength, json.data.length );
		                     
		                    drawCallback( json );
		                }
		            } );
		        }
		        else {
		            json = $.extend( true, {}, cacheLastJson );
		            json.draw = request.draw; // Update the echo for each response
		            json.data.splice( 0, requestStart-cacheLower );
		            json.data.splice( requestLength, json.data.length );
		 
		            drawCallback(json);
		        }
		    }
		};
		 
		// Register an API method that will empty the pipelined data, forcing an Ajax
		// fetch on the next draw (i.e. `table.clearPipeline().draw()`)
		$.fn.dataTable.Api.register( 'clearPipeline()', function () {
		    return this.iterator( 'table', function ( settings ) {
		        settings.clearCache = true;
		    } );
		} );

		//actual table setup 
		$(document).ready( function () {
		    var table = $('#jobList').DataTable({
		    	processing: true,
		        serverSide: true,
		        ajax: $.fn.dataTable.pipeline( {
		            url: 'scripts/server_processing.php',
		            pages: 5 // number of pages to cache
		        } )

		    	responsive: {
		    		details: {
		    			type: 'column',
		    			target: 'tr'
		    		}
		    	},
		    	 columns: [
		    	 	{ "data": "", className:"control"},
		            { "data": "term",       	className: "all none" },
		            { "data": "location"},
		            { "data": "jobposition",    className: "all" },
		            { "data": "department", 	className: "none"},
		            { "data": "agency"},
		            { "data": "dateposted",     className: "none"},
		            { "data": "link", 			className: "none"}
		        ],
		        order: [[6, "desc"]],
		        columnDefs: [ {
		            className: 'control',
		            orderable: false,
		            targets:   0
		        } ],
		        displayLength: 25,
		        drawCallback: function ( settings ) {
		            var api = this.api();
		            var rows = api.rows( {page:'current'} ).nodes();
		            var last=null;
 
		            api.column(6, {page:'current'} ).data().each( function ( group, i ) {
		                if ( last !== group ) {
		                    $(rows).eq( i ).before(
		                        '<tr class="group"><td colspan="5" style="font-weight:600;">'+group+'</td></tr>'
		                    );
		 
		                    last = group;
						}
					});
				}
		    });


		    new $.fn.dataTable( table );
		} );
		</script>



		<!-- HTML5 Shim and Respond.js IE8 support of HTML5 elements and media queries -->
		<!-- WARNING: Respond.js doesn't work if you view the page via file:// -->
		<!--[if lt IE 9]>
		<script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
		<script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
		<![endif]-->
	</head>
	<body>
		<header>
			<div class="container">
				<div class="row">
					<div class="responsive-logo"></div>
					<div class="pullcontainer">
						<a href="#" id="pull"><i class="fa fa-bars fa-2x"></i></a>
					</div>
				</div>
				<div class="row">
					<div class="col-md-8 col-md-offset-2">
						<nav>
							<a href="{{ url_for('main') }}"><div class="logo-holder"></div></a>
							<ul class="clearfix nav-justified">
								<li><a href="{{ url_for('about') }}">About</a></li>
								<!-- <li class="dot">.</li> 
								<li><a href="{{ url_for('main') }}" class="r_spacer">Jobs</a></li>-->
								<!--<li><a href="{{ url_for('metrics') }}">Metrics</a></li>
								<li class="dot">.</li>-->
								<li><a href="{{ url_for('submit') }}">Submit</a></li>
							</ul>
						</nav>
					</div>
				</div>
			</div>
		</header>
		<section class="sign_up" id="signUp">
			<div class="container">
				<div class="row">
					<div class="col-md-6 col-md-offset-3 sign-up">
						{% if subscribe_bool == True %}
							<h2 class="logo-header">Thank you for subscribing!</h2>
						{% else %}
							<h2 class="logo-header">Subscribe for weekly updates!</h2>
							<form name="signup-form" method="post">
								<input class="signup-input" type="email" name="email_address" value="" placeholder="enter your email..." title="Please enter a valid email address." required>
								<button type="submit" value="email_subscribe" name="submit" class="submit-btn">GO</button>
							</form>
						{% endif %}
					</div>
				</div>
			</div>
		</section>
		{% block content %} 
		{% endblock %}
		
		<footer id="contact">
			<div class="container">
				<div class="row">
					<div class="col-md-4 footer-leftcol">
						<p><span class="bold-16p">SpaceJobs</span><br>
						25 The Esplanade<br>
						Toronto, ON, Canada M5E1W5<br>
						<a href="#">spacejobs.us@gmail.com</a>
						</p>
					</div>
				</div>
			</div>
		</footer>
		
		<!-- Include all compiled plugins (below), or include individual files as needed -->
		<script src="{{ url_for('static', filename='js/bootstrap.min.js') }}"></script>
		<script src="{{ url_for('static', filename='js/jquery.flexslider.js') }}"></script>
		<script src="{{ url_for('static', filename='js/scripts.js') }}"></script>
		<script src="{{ url_for('static', filename='js/modernizr.js') }}"></script>
		<script src="{{ url_for('static', filename='js/waypoints.min.js') }}"></script>

	</body>
</html>